# PHP2021


##hw-1
Работа с окружением

Цель:
Познакомиться с различными типами организации окружения. Осознать их применимость и необходимость. 
Научиться настраивать рабочее окружение для своих проектов с использованием автоматизации.

Docker

Установить Docker себе на локальную машину
Описать инфраструктуру в Docker-compose, которая включает в себя
2.1. nginx (обрабатывает статику, пробрасывает выполнение скриптов в fpm)

2.2. php-fpm (соединяется с nginx через unix-сокет)

2.3. redis (соединяется с php по порту)

2.4. memcached (соединяется с php по порту)

БД подключать как отдельную VM (можно на базе Homestead), либо как контейнер (но тогда не забудьте про директории с 
данными)
Виртуальные машины.

Развернуть Homestead VM при помощи Vagrant и VirtualBox
Сайт должен отвечать на доменное имя application.local
Должна быть поддержка проброса директорий
Критерии оценки:
Каждый RUN в Dockerfile будет создавать промежуточный образ при сборке. Помните об этом. Желательно снизить их 
использование до минимума.

Docker - 5 баллов
Виртуалки - 5 баллов


##hw-2
Bash

Цель:
Научиться писать bash-скрипты для решения повседневных задач

Написать консольное приложение (bash-скрипт), который принимает два числа и выводит их сумму в стандартный вывод. 
Например
./sum.sh 1.5 -7

Если предоставлены неверные аргументы (для проверки на число можно использовать регулярное выражение) вывести ошибку в 
консоль.

Если Вы запускаете скрипты на базе Docker под Windows 10, то поведение функции sort по умолчанию отличается от 
стандартного в linux (числа сортируются как числа, а не как строки)

Имеется таблица следующего вида:
id user city phone 1 test Moscow 1234123 2 test2 Saint-P 1232121 3 test3 Tver 4352124 4 test4 Milan 7990923 5 test5 
Moscow 908213

Таблица хранится в текстовом файле.

Вывести на экран 3 наиболее популярных города среди пользователей системы, используя утилиты Линукса.

Подсказка: рекомендуется использовать утилиты uniq, awk, sort, head.

Критерии оценки:
Числа для суммирования могут быть отрицательными и вещественными.
Пакет bc для дистрибутивов Linux не является пакетом по умолчанию. Либо предусмотрите момент, когда пакет не установлен,
либо решите проблему при помощи других средств.
Калькулятор - 5 баллов Сортировщик - 5 баллов


##hw-3
Работа с пакетами

Цель:
Научиться создавать свои пакеты и подключать их как Composer-зависимости

Необходимо создать свой пакет.

В pull-request прислать composer.json, в котором приводится пример подключения Вашего пакета.

Критерии оценки:
Пакет должен ставиться при помощи

composer require package-name

Пакет должен отвечать PSR-4 Пакет может подключаться в Composer либо с packagist, либо из GitHub

4 балла за соответствие PSR-4 3 балла успешное подключение к пакету 3 балла за корректность содержимого пакета


##hw-4
Браузерное и консольное приложения

Цель:
Учимся писать приложения. До того, как изучить принципы написания хорошего ПО, нужно прочувствовать, где и какие есть 
пробелы в знаниях. Заодно - научиться работать с новыми для себя технологиями.

###task1-browser-app-brackets
Верификация строки со скобками Используя Docker, вы описали сборку двух контейнеров – один с nginx, второй – с php-fpm и
вашим кодом. Используя docker-compose вы запускаете оба контейнера. Контейнер с nginx пробрасывает 80 порт на вашу 
хостовую машину и ожидает соединений. Клиент соединяется, и шлёт следующий HTTP-запрос:
POST / HTTP/1.1

string=(()()()()))((((()()()))(()()()(((()))))))

String - это POST-параметр, который можно проверять:

1.1. На непустоту 1.2. На корректность кол-ва открытых и закрытых скобок

Все запросы с динамическим содержимым (*.php) nginx, используя директиву fastcgi_pass, проксирует в контейнер с php-fpm 
и вашим кодом. Nginx должен обрабатывать запросы не обращая внимания на директиву Host. После обработки, • если строка 
корректна, то пользователю возвращается ответ 200 OK, с информационным текстом, что всё хорошо; • если строка 
некорректна, то пользователю возвращается ответ 400 Bad Request, с информационным текстом, что всё плохо.

###task2-console-app-chat-unix-socket
Консольный чат на сокетах Создать логику, размещаемую в двух php-контейнерах (server и client), объединённых общим 
volume. Скрипты запускаются в режиме прослушивания STDIN и обмениваются друг с другом вводимыми сообщениями через 
unix-сокеты.
Критерии оценки:
Валидатор - 5 баллов Чат - 5 баллов

Строка в примере - только пример. На тестах она должна быть любой

Соответствие скобок должно быть и с точки зрения скобок. Тест ")(" не должен проходить

Конструкции @ и die неприемлемы. Вместо них используйте исключения

С точки зрения логики веб-сервиса ответ 400 - это валидное завершение работы скрипта

В рамках одной машины (без сетевого соединения) сборка LNMP гораздо быстрее работает при соединении FPM и Nginx через 
socket. Плюс за использование именно такой настройки.

Принимается только Unix-сокет

Код здесь и далее мы пишем с применением ООП

Код здесь и далее должен быть конфигурируем через файлы настроек типа config.ini

Обратите внимание на паттерн FrontController (он же - единая точка доступа). Все приложения, которые Вы создаёте здесь и
далее должны вызываться через один файл index.php, в котором есть ТОЛЬКО

Точка входа - app.php

Сервер и клиент запускаются командами

php app.php server php app.php client

В app.php только строки
require_once('/path/to/composer/autoload.php');

try { $app = new App(); $app->run(); } catch(Exception $e){ }

Логика чтения конфигураций и работы с сокетами - только в классах.


##hw-5
Ещё одно приложение и балансировщик

Цель:
Закрепить навыки программирования Научиться конфигурировать балансируемое приложение

###task1-email-verify
Приложение верификации email
1.1. Реализовать приложение (сервис/функцию) для верификации email. 
1.2. Реализация будет в будущем встроена в более
крупное решение. 
1.3. Минимальный функционал - список строк, которые необходимо проверить на наличие валидных email. 
1.4. Валидация по регулярным выражения и проверке DNS mx записи, без полноценной отправки письма-подтверждения.

###task2-balancer
Создать как минимум три машины/контейнера
Балансировщик nginx-upstream
Балансируемые бэкенды на nginx (у каждого свой php-fpm)
Подключите к обоим контейнерам fpm по контейнеру с Memcached

###task3-cluster-memcached
3.* Усложнённая задача для тех, кто хочет проверить свои силы 3.0. 
Если у Вас есть балансировка, стандартными сессиями уже не обойтись. 
Иначе не будет работать аутентификация. 3.1. 
Объедините оба Memcached в кластер. 
Можно использовать repcache 3.2. 
Переведите хранение сессий в него

##hw-6
Проектирование БД

Цель:
Закрепить навыки проектирования баз данных; Научиться правильно нормализовать хранение данных; Научиться описывать БД
через DDL;

Спроектируйте схему данных для системы управления кинотеатром

Кинотеатр имеет несколько залов, в каждом зале идет несколько разных сеансов, клиенты могут купить билеты на сеансы
Спроектировать базу данных для управления кинотеатром
Задокументировать с помощью логической модели
Написать DDL скрипты
Написать SQL для нахождения самого прибыльного фильма
Критерии оценки:
Достаточность таблиц и связей между ними
Выполнение правил нормализации
Наличие логической модели
Указание типов данных в логической модели

##hw-7
EAV модель

Цель:
Потренироваться в написании сложных SQL-запросов поверх схемы для проверки правильности структуры. 
Усилить схему гибким хранением значений различного типа без нарушения нормализации.

Спроектировать EAV-хранение для базы данных кинотеатра 4 таблицы: фильмы, атрибуты, типы атрибутов, значения. 
Типы атрибутов и соответствующие им атрибуты (для примера):

рецензии (текстовые значения) - рецензии критиков, отзыв неизвестной киноакадемии ...
премия (заменяется при печати баннеров и билетов на изображение, логическое значение) - оскар, ника ...
"важные даты" даты (при печати - наименование атрибута и значение даты, тип дата) - мировая премьера, премьера в РФ ...
служебные даты (используются при планировании, тип дата) - дата начала продажи билетов, когда запускать рекламу на ТВ... 
View сборки служебных данных в форме (три колонки):
фильм, задачи актуальные на сегодня, задачи актуальные через 20 дней View сборки данных 
для маркетинга в форме (три колонки):
фильм, тип атрибута, атрибут, значение (значение выводим как текст)
Критерии оценки:
Учтены все допустимые типы данных
Учтена специфика хранения и последующего использования float-данных
EAV-схема оснащена индексами

##hw-8
Индексирование данных

Цель:
Научиться повышать производительность сервера БД на уровне администрирования настроек.

Подготовить список из 6 основных запросов к БД, разработанной на предыдущих занятиях. Целесообразно выбрать 3 "простых" 
(задействована 1 таблица), 3 "сложных" (агрегатные функции, связи таблиц). 
Скрипт для наполнения основных таблиц БД тестовыми данными. 
Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000. 
Провести анализ производительности запросов к БД, сохранить планы выполнения. 
Заполнить таблицы, увеличив общее количество строк текстовых данных до 10000000. 
Провести анализ производительности запросов к БД, сохранить планы выполнения. 
На основе анализа запросов и планов предложить оптимизации (индексы, структура, параметры и др.), 
выполнить их, сравнить результат (планы выполнения).

Критерии оценки:
Результат:

скрипт создания БД (с предыдущих занятий)
скрипт заполнения БД тестовыми данными
таблица с результатами по каждому из 6 запросов
запрос
план на БД до 10000 строк
план на БД до 10000000 строк
план на БД до 10000000 строк, что удалось улучшить
перечень оптимизаций с пояснениями
отсортированный список (15 значений) самых больших по размеру объектов БД (таблицы, включая индексы, сами индексы)
отсортированные списки (по 5 значений) самых часто и редко используемых индексов

##hw-9
ElasticSearch

Цель:
Научиться создавать приложение для анализа каналов на Youtube Закрепить навыки работы с БД на уровне логики

Создать приложение для анализа каналов на Youtube: 1.1. 
Создать структуру/структуры хранения информации о канале и видео канала в ElasticSearch, 
описать в виде JSON с указанием типов полей. Описать какие индексы понадобятся в данной структуре? 1.2. 
Создать необходимые модели для добавления и удаления данных из коллекций 1.3. 
Реализовать класс статистики, который может возвращать: 
- Суммарное кол-во лайков и дизлайков для канала по всем его видео 
- Топ N каналов с лучшим соотношением кол-во лайков/кол-во дизлайков 
  1.4*. Можно создать паука, который будет ходить по Youtube и наполнять базу данными

Критерии оценки:
Работа c ES при помощи готовых библиотек
Выделен слой кода, отвечающий за работу с хранилищем

##hw-10
Redis

Цель:
Научиться взаимодействовать с Redis

Аналитик хочет иметь систему со следующими возможностями:

Система должна хранить события, которые в последующем будут отправляться сервису событий
События характеризуются важностью (аналитик готов выставлять важность в целых числах)
События характеризуются критериями возникновения. Событие возникает только если выполнены 
все критерии его возникновения. 
Для простоты все критерии заданы так: <критерий>=<значение>
Таким образом предположим, что аналитик заносит в систему следующие события: 
{ priority: 1000, conditions: { param1 = 1 }, event: { ::event:: }, }, 
{ priority: 2000, conditions: { param1 = 2, param2 = 2 }, event: { ::event:: }, }, 
{ priority: 3000, conditions: { param1 = 1, param2 = 2 }, event: { ::event:: }, },

От пользователя приходит запрос: { params: { param1 = 1, param2 = 2 } }

Под этот запрос подходят первая и третья запись, т.к. в них обеих выполнены все условия, 
но приоритетнее третья, так как имеет больший priority.

Написать систему, которая будет уметь:

добавлять новое событие в систему хранения событий
очищать все доступные события
отвечать на запрос пользователя наиболее подходящим событием
использовать для хранения событий redis
Критерии оценки:
Желательно параллельно попрактиковаться и выполнить ДЗ в других NoSQL хранилищах
Слой кода, отвечающий за работу с хранилищем должен позволять легко менять хранилище
Основная задача - реализация одного из перечисленных паттернов на произвольной таблице
Желательно реализовать метод массового получения информации
Желательно реализовать один из паттернов: Identity Map или Lazy Load
