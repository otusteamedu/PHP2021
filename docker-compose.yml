version: '3'

services:

  webserver:
    build: ./nginx/webserver
    image: webserver/nginx
    container_name: webserver
    ports:
      - 80:80
    volumes:
      - ./nginx/webserver/default.conf:/etc/nginx/conf.d/default.conf
      - ./code:/var/www/application.local
    networks:
      - network

  backend_1_php_fpm:
    build: ./php-fpm/backend_1
    image: backend_1/php
    container_name: backend_1_php_fpm
    volumes:
      - ./code:/var/www/application.local
    networks:
      - network
    environment:
      MEMCACHED_SERVER: backend_1_memcached
      MEMCACHED_PORT: 11211
    
  backend_1_webserver:
    build: ./nginx/backend_1
    image: backend_1_webserver/nginx
    container_name: backend_1_webserver
    ports:
      - 81:81
    volumes:
      - ./nginx/backend_1/default.conf:/etc/nginx/conf.d/default.conf
      - ./code:/var/www/application.local
    networks:
      - network

  backend_1_memcached:
    image: memcached:latest
    container_name: backend_1_memcached
    ports:
      - 11211:11211
    networks:
      - network
    
  
  backend_2_php_fpm:
    build: ./php-fpm/backend_2
    image: backend_2/php
    container_name: backend_2_php_fpm
    volumes:
      - ./code:/var/www/application.local
    networks:
      - network
    environment:
      MEMCACHED_SERVER: backend_2_memcached
      MEMCACHED_PORT: 11212
    
  backend_2_webserver:
    build: ./nginx/backend_2
    image: backend_2_webserver/nginx
    container_name: backend_2_webserver
    ports:
      - 82:82
    volumes:
      - ./nginx/backend_2/default.conf:/etc/nginx/conf.d/default.conf
      - ./code:/var/www/application.local
    networks:
      - network

  backend_2_memcached:
    image: memcached:latest
    container_name: backend_2_memcached
    ports:
      - 11212:11212
    networks:
      - network

networks:
  network:
    driver: bridge

  
