version: '3'

services:

  fmp1:
    image: fpm1
    build:
      context: ./fpm1
      dockerfile: Dockerfile
    container_name: container_fpm1
    volumes:
      - ./code:/code/hw-5.loc
    networks:
      - app-network
    environment:
      MEMCACHED_SERVER: memcached1
      MEMCACHED_PORT: 11211

  memcached1:
    image: memcached:latest
    container_name: memcached1
    ports:
      - 11211:11211
    networks:
      - app-network

  fmp2:
    image: fpm2
    build:
      context: ./fpm2
      dockerfile: Dockerfile
    container_name: container_fpm2
    volumes:
      - ./code:/code/hw-5.loc
    networks:
      - app-network
    environment:
      MEMCACHED_SERVER: memcached2
      MEMCACHED_PORT: 11212

  memcached2:
    image: memcached:latest
    container_name: memcached2
    ports:
      - 11212:11212
    networks:
      - app-network


  nginx1:
    image: nginx1
    build:
      context: ./nginx1
      dockerfile: Dockerfile
    container_name: container_nginx1
    volumes:
      - ./code:/code/hw-5.loc
    networks:
      - app-network

  nginx2:
    image: nginx2
    build:
      context: ./nginx2
      dockerfile: Dockerfile
    container_name: container_nginx2
    volumes:
      - ./code:/code/hw-5.loc
    networks:
      - app-network

  balanicer:
    image: balancer
    build:
      context: balancer
      dockerfile: Dockerfile
    container_name: balancer

    ports:
      - "80:80"
    volumes:
      - ./code:/code/hw-5.loc
    networks:
      - app-network


networks:
  app-network:
    driver: bridge